defmodule LexinWeb.OGImageController do
  use LexinWeb, :controller

  @template_svg """
  <svg viewBox="0 0 1200 630" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="0" width="1200" height="630" fill="#fff"/>

    <path fill="#0069d9" d="M1027.235 37.953c4.382 1.856 10.332 1.632 13.722 4.03 3.39 2.4 4.158 7.453 3.934 12.38-.192 4.925-1.44 9.723-3.806 13.85-2.367 4.157-5.885 7.676-10.044 9.659-4.158 1.951-8.924 2.43-13.594 2.207a44.744 44.744 0 0 1-13.785-2.847c-4.606-1.727-9.244-4.286-11.611-8.22-2.367-3.903-2.463-9.212-1.408-13.914 1.088-4.67 3.295-8.732 5.694-12.635 2.399-3.87 4.958-7.58 8.476-9.915 3.55-2.335 8.028-3.327 11.643-1.855 3.646 1.471 6.429 5.405 10.78 7.26z"/>
    <path fill="#fff" aria-label="Lex" d="m1015.205 59.218-.45 6.327h-16.627v-1.064q.36-.03 1.034-.105.69-.075.96-.195.45-.195.645-.57.21-.375.21-.96V47.419q0-.51-.18-.9-.165-.39-.675-.63-.345-.179-.975-.344-.614-.18-1.02-.21V44.27h8.982v1.064q-.42.015-1.095.15-.66.135-.96.24-.509.18-.704.615-.18.435-.18.93v14.288q0 .99.09 1.544.105.54.465.84.345.27 1.02.36.69.075 1.919.075.555 0 1.154-.03.6-.03 1.14-.12.525-.09.96-.24.45-.165.66-.405.614-.69 1.424-2.084.824-1.41 1.139-2.279zm14.2 2.849q-.93 1.769-2.49 2.819t-3.583 1.05q-1.784 0-3.134-.63-1.334-.63-2.204-1.71-.87-1.08-1.304-2.519-.42-1.44-.42-3.043 0-1.44.45-2.82.464-1.394 1.35-2.503.854-1.065 2.113-1.71 1.275-.66 2.849-.66 1.62 0 2.774.51t1.874 1.395q.69.84 1.02 1.98.344 1.139.344 2.473v.99h-9.79q0 1.454.27 2.639.284 1.184.884 2.084.585.87 1.53 1.379.944.495 2.248.495 1.335 0 2.294-.615.975-.63 1.875-2.249zm-3.314-5.638q0-.84-.15-1.799-.135-.96-.45-1.604-.345-.69-.945-1.125-.6-.435-1.544-.435-1.574 0-2.624 1.32-1.034 1.304-1.124 3.643zm19.266 9.116h-6.777v-.99q.675-.074 1.14-.15.48-.074.48-.39 0-.134-.15-.419t-.3-.525q-.375-.584-1.035-1.559-.645-.99-1.59-2.354-.779.975-1.439 1.904-.66.915-1.379 1.95-.105.15-.225.374-.105.225-.105.36 0 .33.42.555.435.21 1.29.285v.96h-5.473v-.93q1.02-.3 1.634-.72.63-.435 1.155-1.065.464-.6 1.289-1.649.84-1.05 2.16-2.849-.766-1.094-1.875-2.668-1.095-1.59-1.814-2.64-.39-.569-.9-.914-.495-.36-1.41-.36v-.99h6.433v.99q-.48 0-.945.06-.465.06-.465.27 0 .135.09.3.09.165.225.36l1.02 1.574q.705 1.065 1.514 2.25.525-.72 1.215-1.68.704-.96 1.29-1.83.06-.104.12-.254.06-.165.06-.315 0-.315-.526-.495-.51-.195-.974-.27v-.96h5.457v.93q-1.154.3-1.799.72-.645.405-1.094.945-.495.614-1.185 1.514-.675.9-1.904 2.519 1.364 1.919 2.219 3.148.855 1.23 1.724 2.534.435.66.96 1.05.54.375 1.47.435z"/>
    <path fill="#0069d9" aria-label="in.mobi" d="M1053.787 65.545h-7.152v-.99l.705-.06q.375-.03.645-.12.42-.134.615-.464.21-.345.21-.885v-9.13q0-.48-.225-.87-.21-.405-.6-.675-.285-.18-.825-.3-.54-.135-.99-.165v-.974l5.218-.33.21.21v12.054q0 .525.195.87.21.345.645.51.33.135.645.225.315.075.704.105zm-1.889-20.796q0 .855-.57 1.5-.554.63-1.379.63-.765 0-1.334-.6-.555-.615-.555-1.395 0-.824.555-1.439.57-.615 1.334-.615.855 0 1.394.585.555.57.555 1.334zm20.031 20.796h-7.241v-.99q.344-.03.75-.06.42-.03.689-.12.42-.134.615-.464.21-.345.21-.885v-7.601q0-1.575-.75-2.43-.735-.854-1.8-.854-.794 0-1.454.255-.66.24-1.17.6-.494.345-.794.75-.285.39-.42.63v8.5q0 .51.21.84.21.33.63.51.315.15.675.225.375.075.764.105v.99h-7.241v-.99l.704-.06q.375-.03.645-.12.42-.135.615-.465.21-.345.21-.885v-9.13q0-.51-.225-.93-.21-.435-.6-.705-.285-.18-.675-.255-.39-.09-.84-.12v-.974l4.919-.33.21.21v2.084h.074q.36-.36.9-.855.54-.51 1.02-.824.554-.36 1.319-.6.765-.24 1.724-.24 2.13 0 3.149 1.334 1.034 1.32 1.034 3.524v7.691q0 .525.18.855.18.315.615.495.36.15.615.21.27.06.734.09zm6.957-1.724q0 .84-.614 1.44-.6.584-1.44.584t-1.454-.585q-.6-.6-.6-1.439 0-.84.6-1.44.615-.614 1.454-.614.84 0 1.44.615.614.6.614 1.439zm28.458 1.724h-7.212v-.99l.69-.06q.36-.03.63-.12.42-.134.614-.464.21-.345.21-.885v-7.631q0-1.56-.72-2.4-.704-.854-1.769-.854-.735 0-1.38.225-.644.225-1.184.63-.435.33-.734.72-.285.374-.435.63v8.53q0 .525.18.87.18.33.614.51.345.135.615.21.285.06.735.09v.99h-7.062v-.99q.345-.03.66-.06.33-.03.6-.12.42-.135.614-.465.21-.345.21-.885v-7.631q0-1.56-.72-2.4-.704-.854-1.769-.854-.735 0-1.38.24-.644.225-1.184.63-.435.33-.734.75-.3.404-.45.614v8.471q0 .51.21.855t.63.525q.314.15.644.225.33.075.735.105v.99h-7.182v-.99l.705-.06q.374-.03.644-.12.42-.135.615-.465.21-.345.21-.885v-9.19q0-.48-.225-.855-.21-.39-.6-.66-.285-.18-.704-.285-.42-.12-.87-.15v-.974l4.948-.33.21.21v2.114h.105q.374-.375.914-.885t1.005-.824q.525-.36 1.304-.6.795-.24 1.71-.24 1.439 0 2.473.78 1.035.764 1.485 1.859.54-.525.944-.915.42-.405 1.095-.854.57-.39 1.334-.63.78-.24 1.724-.24 1.875 0 2.97 1.23 1.094 1.229 1.094 3.778v7.511q0 .525.18.87.18.33.614.51.345.135.675.21.345.06.765.09zm16.133-7.541q0 1.559-.495 3.073-.495 1.5-1.41 2.55-1.034 1.199-2.398 1.783-1.365.585-3.06.585-1.409 0-2.683-.525-1.274-.54-2.264-1.559-.975-1.005-1.56-2.444-.569-1.454-.569-3.254 0-3.463 2.01-5.667 2.023-2.204 5.292-2.204 3.104 0 5.113 2.099 2.024 2.084 2.024 5.563zm-3.104.03q0-1.125-.225-2.37-.225-1.259-.675-2.128-.48-.93-1.259-1.485-.78-.57-1.904-.57-1.155 0-1.98.57-.809.57-1.319 1.56-.48.914-.674 2.084-.195 1.17-.195 2.264 0 1.439.225 2.668.24 1.215.75 2.174.509.96 1.274 1.515.78.54 1.919.54 1.874 0 2.969-1.815 1.094-1.814 1.094-5.007zm20.256.105q0 3.328-2.099 5.592t-4.873 2.264q-1.214 0-2.399-.375-1.17-.375-2.204-1.004l-1.11 1.724-.929-.21q.075-1.11.105-2.669.03-1.56.03-3.014V45.814q0-.51-.24-1.02-.225-.51-.585-.734-.284-.195-.96-.285-.659-.105-1.064-.135v-.96l5.428-.345.21.225v9.746l.105.03q.93-.99 2.024-1.484 1.11-.495 2.174-.495 2.729 0 4.558 2.159 1.83 2.159 1.83 5.623zm-3.134.104q0-1.109-.24-2.264-.24-1.154-.75-2.009-.509-.87-1.334-1.409-.824-.54-1.979-.54-1.05 0-1.844.42-.78.405-1.41 1.11v8.606q.09.36.346.84.27.48.72.914.45.42 1.019.69.57.255 1.394.255 1.83 0 2.954-1.77 1.125-1.769 1.125-4.843zM1150 65.545h-7.152v-.99l.705-.06q.375-.03.645-.12.42-.134.614-.464.21-.345.21-.885v-9.13q0-.48-.225-.87-.21-.405-.6-.675-.284-.18-.824-.3-.54-.135-.99-.165v-.974l5.218-.33.21.21v12.054q0 .525.195.87.21.345.645.51.33.135.644.225.315.075.705.105zm-1.89-20.796q0 .855-.569 1.5-.555.63-1.38.63-.764 0-1.334-.6-.555-.615-.555-1.395 0-.824.555-1.439.57-.615 1.335-.615.854 0 1.394.585.555.57.555 1.334z"/>

    <text style="font-size:30px;font-family:Georgia;fill:#9a9a9a;" x="50" y="65">Шведский → Русский</text>
    <text style="font-size:60px;font-family:Georgia;fill:#333333;" x="50" y="170">lastbil</text>
    <text style="font-size:30px;font-family:Georgia;fill:#9a9a9a;" x="50" y="220">[²lAs:tbi:l]</text>
    <text style="font-size:30px;font-family:Georgia;fill:#9a9a9a;" x="50" y="270">(last|bil, lastbilen, lastbilar)</text>
    <text style="font-size:30px;font-family:Georgia;fill:#333333;" x="50" y="320">bil med flak som kan ta last</text>
    <text style="font-size:60px;font-family:Georgia;fill:#333333;" x="50" y="420">грузовик</text>
    <text style="font-size:30px;font-family:Georgia;fill:#9a9a9a;" x="50" y="470">(грузовая фура)</text>
  </svg>
  """

  def image(conn, %{"definition_id" => dfn_id, "lang" => lang}) do
    IO.inspect({dfn_id, lang})

    image = generate_og_image()

    conn
    |> put_resp_content_type("image/png")
    |> send_resp(200, image)
  end

  defp generate_og_image() do
    {image, _} = Vix.Vips.Operation.svgload_buffer!(@template_svg)

    Image.write!(image, :memory, suffix: ".png")
  end
end
